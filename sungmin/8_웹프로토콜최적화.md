# 웹 프로토콜 최적화

## 8.1 HTTP의 발전
- HTTP/0.9
  - GET 메소드만 존재하고 HTML 텍스트 정보만 읽을 수 있음
  - 클라이언트의 정보를 서버에 전달할 수 없음
- HTTP/1.0
  - HTTP 페이로드 외에도 헤더를 통해 서버에 정보를 전달할 수 있음. 
  - Content-Type 헤더를 이용해 이미지, 동영상 등 다양한 정보를 주고 받을 수 있음
  - Content-Encoding 헤더를 이용해 압축 정보를 주고 받을 수 있음

### 8.1.1 HTTP/1.1
- GET, POST 외에도 PUT과 DELETE를 이용해 파일을 업로드 하거나 서버의 내용을 삭제할 방법도 제공
- Via 헤더를 사용해 중계 서버 정보를 공유하고 Accept 헤더로 클라이언트의 컨텐츠 지원 형식을 미리 알려줄 수 있음
- 하나의 TCP 연결을 재사용하는 지속적 연결 기술이 추가됨
- 파이프라이닝을 통해 응답을 완전하게 받지 않더라도 하나의 TCP 연결 내에서 미리 다음 요청에 대한 처리를 시작
  - 문제점: 주고받는 통신에는 순서가 있어 하나의 요청이 지연될 경우 나머지 요청도 지연되는 HOL(Head-Of-Line bloking)이 발생
<img src="img/img_21.png" width="600px" height="400px">
  
### 8.1.2 HTTP/2
- 텍스트 방식의 프로토콜 메시지를 버리고 이진 포맷을 사용해 프로토콜 자체를 경량화
- 멀티플렉싱, 스트림 우선순위 결정, 헤더 압축, 서버 푸시 같은 새로운 프로토콜 최적화 기능이 추가

### 8.1.3 HTTP/3
- UDP 기반의 QUIC 프로토콜을 사용
- 한번 맺은 QUIC 연결을 재사용해 연결을 만드는 과정에서 소모되는 시간을 줄임

## 8.2 HTTP/2의 최적화 기술
<img src="img/img_22.png" width="600px" height="400px">

### 8.2.1 HTTP/2의 이진 프레임
- 기존 문자열 방식의 프로토콜을 이진 프레임으로 바꾸어 경량화
- HTTP/2 3개 단위의 구조
  - 프레임: HTTP/2 통신상 제일 작은 정보 단위이며 헤더나 데이터 중 하나
  - 메시지: HTTP/1.1 마찬가지로 요청 혹은 응답 단위이며 다수의 프레임으로 이루어져 있음
  - 스트림: 클라이언트와 서버 사이 맺어진 연결을 통해 양방향으로 주고 받는 하나 혹은 복수의 메시지
- 하나의 스트림이 다수의 요청, 응답을 포함하는 구조로 HTTP/1.1 버전보다 동시 요청 및 응답할 수 있는 오브젝트의 갯수가 많아짐
- 스트림의 유연한 구조 덕분에 요청 순서에 상관없이 만들어진 순서대로 클라이언트에게 전달할 수 있음
- 하나의 TCP 연결을 통해 요청과 응답이 비동기 방식으로 이루어지는 멀티플렉싱이 사용되어 HOL 문제를 자연스럽게 해결

### 8.2.2 멀티플렉싱
- HTTP/1.1의 파이프라이닝 기능을 개선한 것
- 요청 순서에 상관없이 만들어진 순서대로 클라이언트에 전달
- TCP 연결상에서 다수의 클라이언트 요청과 서버의 응답이 비동기 방식으로 이루어짐

<img src="img/img_23.png" width="600px" height="400px">

### 8.2.3 헤더 압축
- 클라이언트와 서버 사이의 가상 테이블을 만들어서 동일하고 중복되는 헤더 값들을 저장해 중복 전달을 제거

<img src="img/img_24.png" width="600px" height="400px">

- 정적 테이블: 미리 정의된 자주 사용되는 헤더 필드를 저장
- 동적 테이블: 클라이언트와 서버가 통신하며 주고받는 값들을 업데이트

### 서버 푸시
- 클라이언트 요청이 없어도 서버가 여러 응답을 알아서 보내는 서버 푸시 기능이 추가
- 클라이언트가 특정 컨텐츠를 요청하면 서버는 요청을 미리 예상하고 요청없이도 응답

<img src="img/img_25.png" width="600px" height="400px">


## 8.3 HTTP/3의 최적화 기술

### 8.3.1 QUIC
- UDP를 채택해 TCP의 성능을 개선하려는 기술
- 전달 속도 향상과 더불어 클라이언트 서버간 연결 수를 최소화하고 대역폭을 예상해 패킷 혼잡을 피하는 것이 QUIC의 주요 특징
- Zero RTT: 클라이언트가 한 번이라고 접속했던 서버라면, 별도의 정보 교환 없이 바로 데이터를 보내는 기술

<img src="img/img_26.png" width="600px" height="400px">

## 8.3.2 HTTP/3의 등장 배경

- HPACK, 서버 푸시, 멀티플렉싱 등을 통해 많은 개선을 이루었지만 TCP 프로토콜 자체의 HOL을 완벽하게 해결하지는 못했음
- 새로운 기능을 추가하기 보다 QUIC이라는 UDP 기반의 프로토콜을 사용해 TCP가 가지고 있는 HTTP/2의 단점을 보완하는데 중점

### 8.3.3 HTTP/3의 특징
- TCP/IP 기반 애플리케이션 레이어 프로토콜 HTTP를 QUIC 위로 위치
- TCP HOL의 문제만 개선한 것이 아니라 HTTP/2의 모든 기능을 계승해 UCP의 빠른 성능, QUIC의 효율성, TLS 1.3의 보안성까지 가져감

<img src="img/img_27.png" width="600px" height="400px">

