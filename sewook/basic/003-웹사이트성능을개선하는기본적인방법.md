# 3장 웹 사이트 성능을 개선하는 기본적인 방법

## 3.1 HTTP 요청 수 줄이기

- 요청하는 컨텐츠의 수가 많을수록 로딩 시간이 길어진다.
- 브라우저는 DNS 시스템으로 IP를 알아내 HTML을 호출하고 콘텐츠를 호출한다.
- 따라서 각 콘텐츠의 도메인이 다르면 DNS 조회가 자주 발생해 로딩 시간이 길어진다.
- 페이지에 나타나는 컨텐츠는 동일하게 유지하고 HTTP 요청 수를 줄이는 방법을 찾아야한다.

### 3.1.1 스크립트 파일 병합

- 모듈화된 여러 파일을 하나로 합쳐(번들) 하나의 요청만으로 불러오게 한다면 웹 성능에 도움이 될 수 있다.
- 번들 과정에서 하나의 파일의 크기가 너무 커진다면 오히려 성능에 악영향을 주므로 적절한 크기를 유지하는 것이 중요하다.

### 3.1.2 인라인 이미지

- 인라인 이미지란 CSS안에 해시 정보를 통해 배경 이미지 파일을 삽입하는 기법이다.
- HTML 파일의 용량이 증가하나 HTTP 요청을 보내지 않는다는 장점이 있다.
- 프록시나 브라우저에 캐시될 확률을 높인다.

### 3.1.3 CSS 스프라이트

- 여러 이미지를 하나의 이미지 파일에 합치고 필요한 이미지의 위치 좌표를 사용하는 방식이다.
  - 하나의 background -> 여러개의 background-position
- 하나의 HTTP 요청만으로 여러 이미지를 사용할 수 있다.

<br>

## 3.2 콘텐츠 파일 크기 줄이기

- 콘텐츠 파일의 크기 또한 성능에 영향을 준다.
- 콘텐츠를 유지하면서 크기를 줄이는 방법을 사용해 성능을 개선해야 한다.

### 3.2.1 스크립트 파일 압축 전달

- HTML, CSS, JS, XML, JSON 등은 모두 스크립트 형태의 텍스트 파일이다.
- 클라이언트는 서버에 콘텐츠를 요청하며 자신이 지원하는 알고리즘을 HTTP 요청 헤더에 알려준다.
  - Accept-Encoding: gzip, deflate, sach
- 서버는 이 중 자신이 지원하는 알고리즘을 선택해 클라이언트에게 알려준다.
  - Content-Encoding: gzip
- 클라이언트는 서버의 응답 헤더를 확인 후 서버가 선택한 알고리즘을 사용한다.

### 3.2.2 스크립트 파일 최소화

- 주석, 공백, 개행 문자 등 실제 로직에 영향을 주지 않는 부분을 제거해 스크립트 파일의 크기를 줄일 수 있다.

### 3.2.3 이미지 파일 압축

- 이미지 파일은 파일 정보를 메타 데이터에 포함해 저장한다.
- 메타 데이터는 사람 눈에 안보이기 때문에 이를 제거하면 크기를 상당히 줄일 수 있다.

### 3.2.4 브라우저가 선호하는 이미지 포맷 사용

- 이미지 포맷에는 무손실 이미지 형식인 png, gif와 손실 이미지 형식인 jpeg 등이 있다.
- WebP와 JPEG XR는 압축 효율이 좋은 포맷이다.
  - WebP: 구글에서 개발된 손실 압축 방식의 이미지 포맷이며 동일 품질의 JPEG 보다 10% ~ 80% 정도 작게 압축할 수 있다.
  - JPEG XR: MS에 의해 개발된 이미지 포맷으로 손실 압축과 비손실 압축을 모두 지원하며 JPEG의 약 30% 정도 크기로 압축할 수 있다.

### 3.2.5 큰 파일은 작게 나누어 전송

- 크기가 큰 콘텐츠의 경우 파일의 일부분을 순서대로 다운로드하는 부분 요청 응답 방식을 사용할 수 있다.
- 이 방식은 대용ㄹ양 및 크기를 가늠할 수 없는 콘텐츠 전송에 유용하다.
- 지원 여부는 응답 헤더 "Accept-Ranges: bytes"를 통해 확인할 수 있다.
- 부분 지원이 가능한 컨텐츠에 경우 Range 헤더를 통해 특정 부분만 요청할 수 있다.
  - Range: bytes0-1023: 0부터 1023 바이트까지의 파일만 요청한다.
- 부분 파일 요청은 206 Partial Content로 응답한다.
  - 응답 헤더에 Content-Range는 전체 중 어느 부분을 전송했는가를 나타낸다.
  - Range: bytes=0-50, 100-150와 같이 쉼표로 구분해 여러 범위를 동시에 요청할 수도 있다.
  - Content-length가 실제 요청보다 1바이트 큰 이유는 파일의 마지막임을 알려주는 지시자가 포함되어 있기 때문이다.

<br>

## 3.3 캐시 최적화 하기

- 프록시 서버를 통해 캐시를 하면 로딩 속도를 개선할 수 있을 뿐만 아니라 네트워크 대역폭도 아낄 수 있다.
- 인터넷 캐시는 PUSH 방식과 PULL 방식으로 구분할 수 있다.
  - PUSH: 캐시 영역에 미리 데이터를 복사해 사용자 요청이 과하게 몰릴 것을 대비할 수 있다.
  - PULL: 실제 요청이 있을 때만 캐시에 저장하는 방식이다.

### 3.3.1 인터넷 캐시 사용

- 프록시 서버는 클라이언트가 처음 요청한 콘텐츠를 원본 서버에 대신 요청해 클라이언트 전달하고 저장한다.
- 사용자가 많은 지역에 여러 곳을 선택해 설치한다.
- 지역적으로 가깝기 때문에 응답 속도가 빠르며 트래픽을 분산해 자원을 절약할 수 있다.

### 3.3.2 브라우저 캐시 사용

- 브라우저가 저장할 수 있는 콘텐츠를 클라이언트 측에 저장한다.
- TTL이 결정되면 Cache-Control 헤더를 통해 설정 내용을 클라이언트에 전달한다.
  - Cache-Control: max-age=<초 단위>
  - Cache-Control: no-cache // 캐시 금지

<br>

## 3.4 CDN 사용하기

- CDN은 대용량 인터넷 캐시 영역인 에지 서버(또는 캐시 서버)라 불리는 서버에 콘텐츠를 저장해 사용하는 네트워크 방식이다.
- 주로 ISP의 뎅이터 센터 내에 캐시 서버를 두고 직접 사용자와 연결해 데이터를 전송한다.
- 원거리 origin에서 컨텐트를 전달 받을 때 생길 수 있는 네트워크 지연, 패킷 손실 등의 현상을 줄일 수 있다.
- 사용자는 가까운 에지에서 컨텐츠를 제공받으므로 로딩시간을 단축할 수 있다.
- 원본서버의 부하를 줄일 수 있다.
- 에지 서버와 에지 서버 간 ICP(Internet Cache Protocol)를 사용한 서버 전파를 할 수 있어 캐시 컨텐츠의 재사용률이 높다.
