# 웹 최적화 트렌드

## 웹 최적화의 역사

- `HTTP`가 처음 만들어졌을 때 웹 사이트에 게시된 콘텐츠는 대부분 텍스트.
  - 초기 `HTTP` 버전은 텍스트 메시지를 효과적으로 전송하는 데 목적.
  - 아날로그 전화선을 사용한 인터넷의 데이터 전송 속도가 `50Kbps` 미만.
- 일반 텍스트보다 더 풍부해진 정보들을 보내기 위해 `HTTP/1.0`이 만들어짐.
  - 상용 웹 브라우저들이 등장하면서 `HTML` 스펙도 `1.0`에서 `2.0`으로 업그레이드.
  - 일반인에게 인터넷 통신이 제공되어 이를 이용한 기업들의 비즈니스가 시작되는 시기.
- 텍스트와 더불어 이미지들이 페이지를 장식하기 시작하면서 기업들은 로딩 속도를 개선하는 백엔드 인프라에 투자.
  - 이 시기의 웹 성능 최적화는 서버 용량 증설이나 웹 서버 등 소프트웨어 성능 개선에 집중.
  - 1997년 `HTTP/1.1`에는 웹 성능 최적화를 위한 여러 기능 추가.
    - 연결 효율화를 위한 `Keep-Alive`, 데이터 분할 전송을 위한 `Chunked encoding`, `byte-range` 기능. 브라우저 캐시를 위한 메커니즘 등
- 2000년대에 들어서면서 온라인 상거래가 활성화되고 기업들의 디지털 전환의 본격화되면서 웹 성능 최적화에 대한 기업들이 관심이 크게 높아짐.
  - 이 시기에 많은 웹 전문가들이 웹 사이트 최적화에 있어 프론트엔드의 중요성을 강조.
- 웹 사이트의 로딩 속도가 이탈률, 구매 전환율과 같은 비즈니스 지표에 큰 영향을 준다느 사실이 밝혀짐.
  - 사용자 경험이 매우 강조.

> 웹 사이트 로딩 시 대부분 시간이 브라우저 렌더링에 소요.  
> 웹 사이트 성능을 높이고 사용자 경험을 향상시키려면 브라우저가 웹 리소스들을 처리하는 프론트엔드 최적화에 중점.

### 모바일 기기의 등장과 모바일 사이트 최적화

- 모바일 네트워크 기반의 스마트폰 사용자들이 증가하여 웹 사이트의 많은 것을 변경하고, 모바일 기기의 트래픽이 데스크톱 기기의 트래픽을 크게 앞지르면서, 모바일 사용자 경험의 중요성이 대두.
- 모바일과 데스크톰 사용자의 사이트 경험을 동일하게 만들기 위해 반응형 웹 기술이 적용.
  - 반응형 웹: 데스크톱과 모바일 기기 사용자가 동일한 기능과 사용자 인터페이스를 경험하도록 하자는 디자인 패러다임.
- 데스크톱에서 나타나는 커다란 이미지들을 모바일 기기에서도 동일하게 다운로드하여 사이트 로딩이 느려지기 때문에 모바일 사용자들의 경험에 부정적인 영향을 미침.
- 해결책으로 미디어 쿼리, `<picture>` 태그, `srcset` 속성 등을 이용해 사용자 기기에 따라 다른 크기의 리소스들을 다운로드.
- 또는 브라우저에서 `JavaScript`가 그때그때 필요한 데이터를 다운로드해 처리.
  - `SPA`(Single Page Application) 관련 기술도 여기에 해당.
  - 모바일 기기는 모바일에 필요한 리소스들만 다운로드하면 되므로 전송되는 리소스의 크기가 작고 렌더링은 빨라짐.
  - 브라우저에서 수행되는 `JavaScript`들이 무거워져 초기 다운로드와 구동 시 시간이 걸릴 수 있는 단점.
- 서버 측에서 접속자의 환경을 미리 파악하여 최적화된 리소스들을 만들어 내려주는 방법.
  - 여러가지 면에서 이상적이나, 아직 접속 기기의 정보를 정확하게 파악하기 어렵다는 단점.

> 어떤 접근법이 이상적이라고 말하기 어려우므로 사이트의 성격에 따라 다른 접근법을 사용하는 것을 권장.
>
> > `SPA` 접근법: 예약 사이트, 장바구니, 결제 페이지 등 기능이 강조되거나 페이지의 일부분이 변경되는 사이트.  
> > 서버 측 접근법: 이미지나 동영상 등 시각적인 부분이 강조되고, 다음 페이지로 이동할 때마다 전체 페이지가 다시 로딩되어야 하는 사이트.

> 구글은 모바일 사용자의 경험을 극대화하기 위해 `PWA`(Progressive Web Application)와 `AMP`(Accelerate Mobile Page)를 제시.

---

## `PWA`

> 스마트폰 이용자의 90%가 모바일 웹보다 모바일 앱에서 더 많은 시간을 보낸다고 함.

- 스마트폰에 설치되어 구동되는 네이티브 앱에서 제공하는 이점
  1. 인터넷이 연결되지 않아도 앱이 구동되므로 인터넷이 끊겼을 때 하얀 화면을 보아야 하는 답답함이 없음.
  2. 기기의 운영체제와 보다 잘 통합되어 더 매끄러운 사용자 경험.
  3. 백그라운드에서 관심 있는 뉴스나 정보의 푸시 알림.
  4. 기기의 고유 기능들에도 쉽게 접근해 다양하고 편리한 기능 수행.
- 네이티브 앱을 사용하려면 앱 스토어에서 검색하고 다운도르해야 하는 불편함 존재.
  - 용량이 큰 앱은 다운로드와 설치가 완료될 때까지 시간이 걸린다는 단점.
  - 설치된 앱이 많을수록 기기의 성능이 떨어지고 앱의 수행 속도도 느려짐.
- 모바일 사용자들이 일회성 앱을 지우지 않고 유지하는 이유는 필요할 때 다시 설치해야 하는 불편함 때문.
  - 최신 사양에 맞추어 개발된 앱들은 오히려 중저가 스마트폰 사용자의 경험 저하.
- 모바일 웹에서 제공하는 이점
  1. `URL`만 클릭하면 웹 사이트에 접속할 수 있으므로 앱보다 빠르고 쉽게 접근.
  2. `URL` 링크만으로 많은 사용자들에게 사이트 정보 전파.

> 네이티브 앱은 높은 기능성, 모바일 웹은 넓은 범용성을 제공.

- `PWA`: 네이티브 앱과 모바일 웹의 장점을 모두 갖추도록 특정 기술과 표준 패턴을 사용해 개발한 웹 앱.
  - `Google`의 개발자인 알렉스 러셀, 디자이너인 프랜시스 베어만에 의해 처음 제시되며, 세부 사항은 `Google I/O 2016`에서 소개.
- `PWA`는 브라우저를 통해 구동되므로 사용자가 접근하기에 유용하며, 별도로 설치하지 않아도 됨.
- 오프라인에서 동작 가능하며 푸시 알림을 통해 주요 정보를 능동적으로 전달 가능.
- 전체 화면은 모바일 앱처럼 구성되어 있으며, 모바일 앱과 동일하게 앱 아이콘 추가 가능.
- 이미 잘 알려진 기술들을 사용하므로 비교적 적은 노력으로 `PWA`의 핵심 기능 구현.
- 알렉스가 주장한 `PWA`의 핵심 특징
  1. 모든 형태의 화면에 반응(responsiveness)해야 함.
     - 모든 기기 화면이나 브라우저에서 사용 가능해야 함.
     - 모바일, 노트북, 시계, 냉장고, 안경 등 인터넷이 가능한 기기에서 실행 가능해야 함.
  2. 네트워크 독립적이어야 함.
     - 오프라인이나 네트워크 연결이 불안정한 상황에서도 동작할 수 있어야 함.
     - 서비스 워커(service worker) 기술은 주요 리소스들을 캐시해 오프라인일 때도 동작 가능.
  3. 앱과 같은 상호 작용 기능이 있어야 함.
     - 웹 콘텐츠지만 앱처럼 사용자에게 편리한 기능들을 제공해야 함.
     - 셸(shell)과 콘텐츠가 분리된 모델을 사용하여 탐색과 조작 방식이 웹과 비슷.
  4. 항상 최신 내용으로 업데이트되어 있어야 함.
     - 서비스 워커의 업데이트 프로세스가 캐시된 리소스들을 최신으로 유지.
  5. 웹이나 앱의 모든 연결을 보안상 안전해야 함.
     - 대부분의 앱이 민감한 사용자 정보들을 포함하므로 항상 `HTTPS`를 사용해 암호화된 데이터 전송.
  6. 구현된 애플리케이션은 웹의 검색 엔진에서 쉽게 찾을 수 있어야 함.
     - 애플리케이션 매니페스트 파일(application manifest file)은 브라우저가 응용 프로그램을 식별하는 데 중요한 역할을 하며 애플리케이며 이름, 작성자 및 설명을 포함한 응용 프로그램 정보가 들어 있음.
  7. 재참여할 수 있어야 함.
     - 새 콘텐츠를 사용할 수 있을 때 알림을 보내 사용자가 다시 열어볼 수 있게 해야 함.
     - 브라우저의 푸시 알림 `API`를 이용해 구현.
  8. 설치핧 수 있어야 함.
     - 기기 홈 화면에 언제든 아이콘을 추가해 빠르게 접속할 수 있어야 하며, 모바일 브러우저 기능으로 지원.
       - 사이트를 방문해 홈 화면에 추가 옵션을 클릭하면 홈 화면에 즉시 나타남.
  9. 쉽게 연결할 수 있어야 함.
     - 웹처럼 간단하게 `URL`을 전송해 콘텐츠를 공유할 수 있어야 함.
     - 웹이 가진 가장 큰 장점.
- `PWA`를 사용할 때의 이점
  1. 서비스 워커를 이용한 캐시로 앱 로딩 시간을 줄이고 데이터를 경제적으로 사용.
     - 오프라인에서도 앱 로딩이 가능하므로 사용자의 웹 앱 경험을 향상.
  2. 앱 업데이트 시 변경된 콘텐츠만 업데이트할 수 있어 매우 효율적.
     - 네이티브 앱은 조그마한 수정에도 애플리케이션 전체를 다시 다운로드해야 하므로 많은 시간과 비용이 낭비.
  3. 플랫폼과 상관없이 반응형으로 동작하므로 다양한 플랫폼들 위에서 보다 통합된 형태를 전달.
  4. 시스템 알림 및 푸시 메시지를 통해 사용자의 재참여를 이끌어냄.
     - 구매 전환율 같은 비즈니스 지표 개선 가능.

### `PWA` 주요 기술

#### `PWA` 애플리케이션 아키텍처

- `PWA`는 크게 애플리케이션 셸과 콘텐츠로 구성된 아키텍처.
- 애플리케이션 셸: 응용 프로그램의 인프라를 설명하는 개념.
  - 앱이 처음 동작하는 데 필요한 모든 정적 파일로 구성되며 웹 개발과 관련된 `HTML`, `CSS`, `JavaScript` 및 이미지 파일이 여기에 포함.
- 콘텐츠: 애플리케이션 수명 주기 동안 변경 가능한 데이터
  - 동적인 데이터가 주를 이루므로 애플리케이션 셸에서는 제외.
  - 일반적으로 `API` 서비스를 통해 노출, 조회.
- 앱을 처음 로딩할 때 애플리케이션 셸 파일들을 캐시해야 네트워크 연결 없이 앱이 작동 가능.
  - `PWA`는 콘텐츠가 로딩되지 않아도 캐시된 정적 파일들을 활용해 다양한 방법으로 사용자가 응용 프로그램에 계속 참여하도록 유도.
    - 애니메이션, 스피닝 아이콘 등.
- 오프라인 로딩은 서비스 워커를 이용해 수행.
- 서비스 워커가 오프라인 상황을 대비해 정적 리소스들을 캐시할 수 있지만, 사용자가 웹 사이트를 최초 로딩하면 서비스 워커 스크립트를 비롯한 모든 리소스들을 다운로드해야 함.
  > 이들을 모두 로딩하는 데 걸리는 시간을 최소화하려면 지금까지 살펴보았던 파일 크기 줄이기, 네트워크 요청 수 최소화, 렌더링 가속화 등의 최적화 방법들을 고려해 개발.
- 애플리케이션 셸은 네이티브 앱과 비슷한 사용자 인터페이스를 제공하기 위한 것.
  - 머리글(header), 바닥글(footer), 탐색 메뉴로 구성될 수도 있지만 양식은 없음.
- 콘텐츠에 따라 사용자 내비게이션이 크게 달라지는 사이트라면 기존 애플리케이션 셸이 부적합할 수 있음.
- 일반적으로 오프라인에서 사용하기 위해 셸에 필요한 리소스들과 가장 많이 사용되는 리소스들을 캐시.

#### 애플리케이션 매니페스트 파일

- 매니페스트 파일: 앱의 정보를 담고 있는 `JSON` 기반 파일.
  - 홈 화면에 앱 아이콘을 설치하거나 앱이 로딩될 때 첫 페이지, 표시 방향 등의 구동 정보를 설정하기 위해 필요.
  ```json
  {
    "lang": "ko",
    "name": "Feo Books",
    "description": "This guides you how to optimize your websites!",
    "icons": [
      {
        "src": "/images/icons-1.png",
        "type": "image/png",
        "sizes": "192x192"
      },
      {
        "src": "/images/icons-2.png",
        "type": "image/png",
        "sizes": "512x512"
      }
    ],
    "scope": "/books/",
    "start_url": "/books/index",
    "background_color": "#3367D6",
    "display": "fullscreen",
    "orientation": "landscape",
    "theme_color": "aliceblue"
  }
  ```
- 매니페스트 파일에서 정의할 수 있는 주요 속성.
  | 속성 | 설명|
  |:-:|:-:|
  | `name` or `short_name`| 홈화면에 추가할 때 사용될 이름을 추가. <br /> `short_name`은 전체 이름을 나타내기에는 허용된 공간이 충분하지 않을 때 사용. |
  | `icons` | 홈 화면, 앱 런처 등에 사용될 아이콘을 지정. <br /> 여러 개의 아이콘을 설정할 수 있으며, 최소 두 개 이상의 아이콘을 추가할 것을 권장. <br /> `Google Chrome`에서는 두 개의 아이콘을 앱 로딩이 완료되기 까지의 구동 화면(스플래시?)으로 사용.(SVG 지원 불가) |
  | `start_url` | 앱이 처음 구동될 때 로딩시킬 페이지의 `URL` 지정. <br /> 사용자가 특정 화면에서 앱을 추가했더라도 구동 시에는 이 화면이 로딩. <br /> 앱이 처음 로딩될 때 사용자들에게 가장 필요한 화면을 지정하는 것을 권장. |
  | `background_color` | 앱 로딩이 완료될 때까지 사용자에게 보이는 구동 화면(스플래시 화면)의 배경색을 지정. |
  | `display` | 웹 앱이 화면에 나타나는 방법을 결정. <br /> 일반적인 네이티브 앱은 `standalone` 방식으로 구현. <br /> `fullscreen`, `minimal-ui` 등의 옵션. |
  | `orientation`| 구동 시 화면의 가로 / 세로 방향 여부를 결정. |
  | `scope` | 해당 웹 앱이 탐색 가능한 `URL` 들의 범위를 지정하며, 범위는 `URL` 콘텐스트로 표현. <br /> 사용자가 범위를 벗어나는 `URL`을 탐색할 경우 일반 웹 페이지로 간주되며 `start_url`도 `scope`에 포함. |
  | `theme_color` | 모든 페이지에 적용될 주소창의 색을 지정. |
- 브라우저가 이 매니페스트 파일을 쉽게 찾을 수 있도록 모든 웹 페이지에 파일 링크를 설정해두는 것을 권장.
  ```html
  <link ref="manifest" href="/manifest.json" />
  ```
- [`Google Chrome Developers - Manifest file format`](https://developer.chrome.com/docs/extensions/mv3/manifest/icons/)
- [`PWA` 적용해보기 - `manifest` 적용](https://blog.woolta.com/categories/3/posts/150)

#### 서비스 워커

- 서비스 워커(`service worker`): 오프라인에서 `PWA`를 구동할 수 있는 `JavaScript` 형태의 핵심 기술.
- 브라우저와 독립적으로 백그라운드에서 실행되며 다양한 요청들을 비동기적으로 처리.
  - 브라우저와 네트워크 사이에서는 일종의 프록시처럼 동작하며 네트워크 관련 요청을 가로채 처리하기도 함.
  - 캐시에 리소스를 캐싱하거나 검색하고 필요에 따라 푸시 메시지 전달 가능.
- 이를 통해 `PWA`는 인터넷에 연결되어 있지 않을 때도 캐시에 저장된 데이터나 애플리케이션 셸을 표시하고 네트워크에 연결되지 않았음을 사용자에게 알릴 수 있음.
  - 이후 네트워크에 연결되면 경고가 비활성화되고 최신 데이터가 검색.
- 푸시 알림: 서버에서 사용자 측에 필요한 정보를 일방적으로 전달하는 것.
  - 이를 위해 사용자의 동의를 구하는 절차가 선행.
  - 사용자가 푸시와 알림에 동의하면 서비스 워커는 푸시 서비스에 구독한 것으로 등록하고 이후 서버는 구독한 사용자에게 필요한 데이터를 푸시.
- 백그라운드 동기화 기능: 전송 중인 메시지나 데이터가 네트워크 문제로 정상 전달이 되지 못 했을 때 잠시 로컬 저장소에 저장해 두었다가, 네트워크가 다시 원할해지면 백그라운드에서 전송을 완료하는 기능.
  - 채팅 외에도 이메일, 문서나 사진 업로드와 다운로드 등의 작업을 온전히 전송하는 데 유용.
- 서비스 워커는 `DOM`에 직접 액세스 불가.
  - 웹 워커처럼 `JavaScript`를 사용하는 워커들의 공통 특성이므로 새로운 점은 아님.
  - 대신 `postMessage` 인터페이스를 통해 전달된 메시지에 응답하는 콜백 방식으로 제어 대상 페이지와 통신할 수 있으며, 이러한 비동기적 방식으로 `DOM` 조작 가능.
- 서비스 워커는 등록, 설치, 활성화의 단계를 거침.
  - 등록 단계
    - 사용자가 웹 앱을 최초 방문 시 서비스 워커 스크립트를 다운로드하고 브라우저에 등록하는 단계.
    - 서비스 워커도 `JavaScript`이므로 최초 한 번 뿐이라 해도 브라우저 렌더링에 영향을 줄 수 있음.
      > 등록 시점을 적절히 결정해 등록하는 것을 권장.
  - 설치 단계
    - 캐시를 생성하고 필요한 파일들을 캐시에 저장하는 작업들이 수행.
    - 셸에 필요한 `CSS`, `JavaScript`, 오프라인에서도 사용될 리소스들을 미리 캐시.
  - 활성화 단계
    - 요청된 캐시를 제공하거나 네트워크 프록시 역할 등을 수행.
- 서비스 워커의 수명 주기와 세부 상태는 `Google Chrome` 개발자 도구 - `Application` 탭 - `Service Workers`를 통해 확인 가능.

> 서비스 워커의 기능은 계속 진화하고 있음.  
> 조만간 주기적 동기화와 지오펜싱 기능도 추가될 예정이라고 하니 서비스 워커를 통해 네이티브 앱의 기능들을 웹 앱에서도 구현 가능.

- [`WWDC2022`](https://developer.apple.com/wwdc22/)
- [`MDN` - `Service Worker API`](https://developer.mozilla.org/ko/docs/Web/API/Service_Worker_API)
- [`MDN` - `Web Periodic Background Synchromization API`](https://developer.mozilla.org/en-US/docs/Web/API/Web_Periodic_Background_Synchronization_API)
- [`Safari 용 웹 푸시`](https://webkit.org/blog/12840/web-platform-and-web-extensions-features-highlighted-at-wwdc22/)
- [Android Developers - 지오펜싱(Geofence)](https://er.android.com/training/location/geofencing?hl=ko)
- [지오펜싱이란?](https://kokoutgo.tistory.com/130)
- [주기적 백그라운드 동기화](https://web.dev/i18n/ko/periodic-background-sync/)

### `PWA` 사례

- `QR Scanner`, `Voice Memo` 등 실생활에 유용한 사례들, `POKEDEX` 같은 게임 사례들, 산업별로 잘 구현된 [`PWA` 사례](https://www.pwastats.com)가 많음.
- 스타벅스(https://app.starbucks.com)
- MakeMyTrip(https://www.makemytrip.com)
- Pinterest(https://www.pinterest.co.kr)

---

## `AMP`

- 웹 사이트 개시 초기에는 매우 경량화되어 있어 로딩 속도가 빠르다 하더라도 시간이 지날수록 관리 부재로 사이트가 점점 무거워짐.
- `AMP`는 이미 성능 최적화가 된 웹 컴포넌트들을 제공.
- 또한, 타사 리소스들을 무분별하게 추가할 수 없도록 강제함으로써 개발자가 복잡하고 어려운 최적화 기법에 더이상 신경쓰지 않고 사이트 개발에만 집중할 수 있도록 도와주는 프레임워크.
  - 이론상 `AMP`에서 제시하는 방법대로 개발하면 웹 사이트는 기존보다 4배 정도 빠르게 로딩되어 사용자 경험에 긍정적인 영향을 미침.
- `AMP`는 `Google`이 공개하고 `WICG`(Web Platform Incubator Cummunity Group)의 프로젝트들을 통한 웹 표준화 작업도 진행 중.
- `AMP` 특징들이 표준화되면 굳이 `AMP`를 사용하지 않더라도 빠른 웹 사이트 구축 가능.
- 특히 `Google`은 현재 `AMP`로 구현된 사이트에만 개방되어 있는 `top stories carousel`과 같은 특별한 구글 검색 기능들을 모든 사이트에 개방 가능하게 됨.

### `AMP`의 특징

1. 콘텐츠 렌더링을 방해하지 않음.
2. 레이아웃을 미리 결정하여 리플로우를 방지함.
3. 경량화된 `CSS`를 `HTML` 내부에 작성하여 렌더링을 빠르게 시작.
4. 웹 폰트를 최적화.
5. 스타일과 화면 재배치를 최소화.
6. `GPU` 가속으로 `CPU` 사용을 효율화.
7. 중요한 리소스부터 로딩.

### `AMP`의 구성 요소

#### `AMP HTML`

#### 컴포넌트

#### `AMP cache`

### `AMP`와 반응형 웹 디자인

---

## 웹 최적화의 실상과 과제

### 웹 최적화의 실상

### 웹 최적화의 과제
